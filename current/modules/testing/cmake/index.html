<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    <title>Modules & Scripts - CMake Scripts</title>
    <meta name="description" content="How to write tests for your CMake modules and scripts">
    <meta name="keywords" content="testing, cmake">
    <meta name="author" content="RSP Systems A/S">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <link rel="icon" href="../../../../themes/rsp/favicon/favicon-16x16.png" type="image/x-icon">

    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- JS -->
    <script>
        window.base_url = "../../../../";
        document.documentElement.classList.remove('no-js');
    </script>

    <!-- Font -->
    
    <!-- CSS -->
            <link href='../../../../themes/rsp/css/daux-blue.min.css' rel='stylesheet' type='text/css'>
            <link href='../../../../themes/rsp/css/style.css' rel='stylesheet' type='text/css'>
            <link href='../../../../daux_libraries/search.css' rel='stylesheet' type='text/css'>
    </head>
<body class="">
    <div class="Columns content">
    <aside class="Columns__left Collapsible">
        <button type="button" class="Button Collapsible__trigger" aria-controls="sidebar_content" aria-expanded="false" aria-label="Toggle navigation">
            <span class="Collapsible__trigger__bar"></span>
            <span class="Collapsible__trigger__bar"></span>
            <span class="Collapsible__trigger__bar"></span>
        </button>

        <a class="Brand" href="../../../../index.html">CMake Scripts</a>

    <form role='search' action="/" method="get" class="Search" id="search_form">
        <label for="search_input">
            <span class='u-visuallyHidden'>Search</span>
        </label>
        <input
            type="search"
            id="search_input"
            class="Search__field"
            placeholder="Search..."
            aria-label="Search..."
            autocomplete="on"
            results=25
            autosave=text_search
        >
        <label>
            <input type="submit" class='u-visuallyHidden' />
            <span class='u-visuallyHidden'>Search...</span>
            <svg class="Search__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451 451">
                <path d="M447.05 428l-109.6-109.6c29.4-33.8 47.2-77.9 47.2-126.1C384.65 86.2 298.35 0 192.35 0 86.25 0 .05 86.3.05 192.3s86.3 192.3 192.3 192.3c48.2 0 92.3-17.8 126.1-47.2L428.05 447c2.6 2.6 6.1 4 9.5 4s6.9-1.3 9.5-4c5.2-5.2 5.2-13.8 0-19zM26.95 192.3c0-91.2 74.2-165.3 165.3-165.3 91.2 0 165.3 74.2 165.3 165.3s-74.1 165.4-165.3 165.4c-91.1 0-165.3-74.2-165.3-165.4z"/>
            </svg>
        </label>
    </form>

        <div class="Collapsible__content" id="sidebar_content">
            <!-- Navigation -->
            <ul class='Nav'>
<li class='Nav__item Nav__item--open has-children'><a href="../../../../current/index.html" class="Nav__item__link"><i class="Nav__arrow">&nbsp;</i>Version 0.x</a><ul class='Nav'>
<li class='Nav__item '><a href="../../../../current/release_notes.html">Release Notes</a></li>
<li class='Nav__item '><a href="../../../../current/upgrade_guide.html">Upgrade Guide</a></li>
<li class='Nav__item '><a href="../../../../current/contribution_guide.html">Contribution Guide</a></li>
<li class='Nav__item '><a href="../../../../current/security_policy.html">Security Policy</a></li>
<li class='Nav__item '><a href="../../../../current/code_of_conduct.html">Code of Conduct</a></li>
<li class='Nav__item Nav__item--open has-children'><a href="../../../../current/modules/index.html" class="Nav__item__link"><i class="Nav__arrow">&nbsp;</i>Modules</a><ul class='Nav'>
<li class='Nav__item  has-children'><a href="../../../../current/modules/cache/index.html" class="Nav__item__link"><i class="Nav__arrow">&nbsp;</i>Cache</a><ul class='Nav'>
<li class='Nav__item '><a href="../../../../current/modules/cache/set.html">Set</a></li>
<li class='Nav__item '><a href="../../../../current/modules/cache/get.html">Get</a></li>
<li class='Nav__item '><a href="../../../../current/modules/cache/has.html">Has</a></li>
<li class='Nav__item '><a href="../../../../current/modules/cache/remember.html">Remember</a></li>
<li class='Nav__item '><a href="../../../../current/modules/cache/forget.html">Forget</a></li></ul></li>
<li class='Nav__item  has-children'><a href="../../../../current/modules/git/index.html" class="Nav__item__link"><i class="Nav__arrow">&nbsp;</i>Git</a><ul class='Nav'>
<li class='Nav__item '><a href="../../../../current/modules/git/find_version_tag.html">Find Version Tag</a></li></ul></li>
<li class='Nav__item '><a href="../../../../current/modules/helpers/index.html" class="Nav__item__link"><i class="Nav__arrow">&nbsp;</i>Helpers</a><ul class='Nav'></ul></li>
<li class='Nav__item Nav__item--open has-children'><a href="../../../../current/modules/testing/index.html" class="Nav__item__link"><i class="Nav__arrow">&nbsp;</i>Testing</a><ul class='Nav'>
<li class='Nav__item Nav__item--open has-children'><a href="../../../../current/modules/testing/cmake/index.html" class="Nav__item__link"><i class="Nav__arrow">&nbsp;</i>Modules & Scripts</a><ul class='Nav'>
<li class='Nav__item '><a href="../../../../current/modules/testing/cmake/test_suite.html">Test Suite</a></li>
<li class='Nav__item '><a href="../../../../current/modules/testing/cmake/test_case.html">Test Case</a></li>
<li class='Nav__item '><a href="../../../../current/modules/testing/cmake/test.html">Test</a></li>
<li class='Nav__item '><a href="../../../../current/modules/testing/cmake/run_tests.html">Run Tests</a></li>
<li class='Nav__item '><a href="../../../../current/modules/testing/cmake/executor.html">Executor</a></li>
<li class='Nav__item '><a href="../../../../current/modules/testing/cmake/asserts.html">Asserts</a></li></ul></li></ul></li>
<li class='Nav__item  has-children'><a href="../../../../current/modules/version/index.html" class="Nav__item__link"><i class="Nav__arrow">&nbsp;</i>Version</a><ul class='Nav'>
<li class='Nav__item  has-children'><a href="../../../../current/modules/version/semver/index.html" class="Nav__item__link"><i class="Nav__arrow">&nbsp;</i>Semantic Version</a><ul class='Nav'>
<li class='Nav__item '><a href="../../../../current/modules/version/semver/parse.html">Parse</a></li></ul></li>
<li class='Nav__item '><a href="../../../../current/modules/version/version_file.html">Version File</a></li></ul></li></ul></li></ul></li>
<li class='Nav__item  has-children'><a href="../../../../archive/index.html" class="Nav__item__link"><i class="Nav__arrow">&nbsp;</i>Archive</a><ul class='Nav'>
<li class='Nav__item '><a href="../../../../archive/v_next/index.html" class="Nav__item__link"><i class="Nav__arrow">&nbsp;</i>next</a><ul class='Nav'></ul></li></ul></li></ul>
            <div class="Links">
                                    <hr/>
                                            <a href="https://github.com/rsps/cmake-scripts/blob/main/CHANGELOG.md" target="_blank"  rel="noopener noreferrer">Changelog</a>
                        <br />
                                            <a href="https://github.com/rsps/cmake-scripts" target="_blank"  rel="noopener noreferrer">GitHub</a>
                        <br />
                                            <a href="https://github.com/rsps/cmake-scripts/issues" target="_blank"  rel="noopener noreferrer">Issues</a>
                        <br />
                                            <a href="https://rspsystems.com/" target="_blank"  rel="noopener noreferrer">RSP Systems</a>
                        <br />
                                                </div>

            
            <div class="DarkModeToggler">
                <hr/>
                <label class="Checkbox">Dark Mode                    <input type="checkbox" class="ColorMode__button" />
                    <div class="Checkbox__indicator"></div>
                </label>
            </div>

                
                                    <div class="PoweredBy">
                        <hr/>
                        © RSP Systems A/S                    </div>
                        </div>
    </aside>
    <div class="Columns__right">
        <div class="Columns__right__content">
            <div class="doc_content">
                <article class="Page">

    <div class="Page__header">
        <h1><a href="../../../../current/index.html">Version 0.x</a> <svg class="Page__header--separator" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 477.175 477.175"><path d="M360.73 229.075l-225.1-225.1c-5.3-5.3-13.8-5.3-19.1 0s-5.3 13.8 0 19.1l215.5 215.5-215.5 215.5c-5.3 5.3-5.3 13.8 0 19.1 2.6 2.6 6.1 4 9.5 4 3.4 0 6.9-1.3 9.5-4l225.1-225.1c5.3-5.2 5.3-13.8.1-19z"/></svg> <a href="../../../../current/modules/index.html">Modules</a> <svg class="Page__header--separator" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 477.175 477.175"><path d="M360.73 229.075l-225.1-225.1c-5.3-5.3-13.8-5.3-19.1 0s-5.3 13.8 0 19.1l215.5 215.5-215.5 215.5c-5.3 5.3-5.3 13.8 0 19.1 2.6 2.6 6.1 4 9.5 4 3.4 0 6.9-1.3 9.5-4l225.1-225.1c5.3-5.2 5.3-13.8.1-19z"/></svg> <a href="../../../../current/modules/testing/index.html">Testing</a> <svg class="Page__header--separator" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 477.175 477.175"><path d="M360.73 229.075l-225.1-225.1c-5.3-5.3-13.8-5.3-19.1 0s-5.3 13.8 0 19.1l215.5 215.5-215.5 215.5c-5.3 5.3-5.3 13.8 0 19.1 2.6 2.6 6.1 4 9.5 4 3.4 0 6.9-1.3 9.5-4l225.1-225.1c5.3-5.2 5.3-13.8.1-19z"/></svg> <a href="../../../../current/modules/testing/cmake/index.html">Modules & Scripts</a></h1>
                <span class="ModifiedDate">
            January 29, 2025 at 12:58 AM        </span>
                        <span class="EditOn">
            <a href="https://github.com/rsps/cmake-scripts/blob/main/docs/+current/modules/testing/cmake/index.md" target="_blank">
                Edit on GitHub            </a>
        </span>
            </div>

    <div class="s-content">
        <h1><a id="testing-cmake-modules-scripts" href="#testing-cmake-modules-scripts" class="Permalink" aria-hidden="true" title="Permalink">#</a>Testing CMake Modules &amp; Scripts</h1>
<p>The <code>testing</code> module includes a “<em>mini</em>” framework for testing your CMake modules and scripts. It is built on top of
<a href="https://cmake.org/cmake/help/latest/manual/ctest.1.html#manual:ctest(1)" class="Link--external" rel="noopener noreferrer">CTest</a>.</p>
<div class="TableOfContentsContainer">
    <h4 class="TableOfContentsContainer__title">Table of Contents</h4>
    <div class="TableOfContentsContainer__content">
        <ul class="TableOfContents">
<li><a href="#testing-cmake-modules-scripts">Testing CMake Modules &amp; Scripts</a>
<ul>
<li><a href="#getting-started">Getting Started</a>
<ul>
<li><a href="#directory-structure">Directory Structure</a></li>
<li><a href="#define-test-suite">Define Test Suite</a></li>
<li><a href="#define-test-case">Define Test Case</a></li>
<li><a href="#define-test-s">Define Test(s)</a></li>
<li><a href="#build-run">Build &amp; Run</a></li>
</ul>
</li>
<li><a href="#caveats">Caveats</a></li>
</ul>
</li>
</ul>    </div>
</div>
<h2><a id="getting-started" href="#getting-started" class="Permalink" aria-hidden="true" title="Permalink">#</a>Getting Started</h2>
<p>The following guide illustrates how you can get started. It is by no means a comprehensive guide on how to write tests,
but rather just a starting point.</p>
<h3><a id="directory-structure" href="#directory-structure" class="Permalink" aria-hidden="true" title="Permalink">#</a>Directory Structure</h3>
<p>Create an appropriate directory in which your tests should reside. For instance, this can be located in the root
of your project. You can name it “tests”, or whatever makes the most sense for you. The important part is to isolate
tests from the remaining of your project’s CMake logic.</p>
<p>The following example is a possible directory and files structure, that you can use.</p>
<pre><code>/tests
    /unit
        /assets
            build_assets_test.cmake
    CMakeLists.txt    
CMakeLists.txt
</code></pre>
<h3><a id="define-test-suite" href="#define-test-suite" class="Permalink" aria-hidden="true" title="Permalink">#</a>Define Test Suite</h3>
<p>In your <code>/tests/CMakeLists.txt</code>, define the <a href="test_suite.html">test suite(s)</a> for your project.</p>
<pre><code class="hljs cmake"><span class="hljs-comment"># ...in your /tests/CMakeLists.txt</span>

<span class="hljs-keyword">enable_testing</span>()

<span class="hljs-keyword">project</span>(my_package_tests LANGUAGES NONE)

<span class="hljs-keyword">include</span>(<span class="hljs-string">"rsp/testing"</span>)

<span class="hljs-comment"># Define the test suites for this project</span>
define_test_suite(<span class="hljs-string">"unit"</span> DIRECTORY <span class="hljs-string">"${CMAKE_CURRENT_SOURCE_DIR}/unit"</span>)
</code></pre>
<h3><a id="define-test-case" href="#define-test-case" class="Permalink" aria-hidden="true" title="Permalink">#</a>Define Test Case</h3>
<p>To define a new test case, invoke the <a href="test_case.html"><code>define_test_case()</code></a> function.
This should be done in each test file (<em>e.g. in the <code>/tests/unit/assets/build_assets_tests.cmake</code> from the above
shown example directory and files structure).</em></p>
<pre><code class="hljs cmake"><span class="hljs-comment"># ... in your test file</span>

<span class="hljs-keyword">include</span>(<span class="hljs-string">"rsp/testing"</span>)

define_test_case(
    <span class="hljs-string">"Build Assets Test"</span>
    LABELS <span class="hljs-string">"assets;build"</span>
)

<span class="hljs-comment"># ... remaining not shown ...</span>
</code></pre>
<h3><a id="define-test-s" href="#define-test-s" class="Permalink" aria-hidden="true" title="Permalink">#</a>Define Test(s)</h3>
<p>Once your test-case has been defined, you can define the tests. To do so, you need to define the function that must
be invoked when the test-case is executed. This is done by the <a href="test.html"><code>define_test()</code></a> function.</p>
<pre><code class="hljs cmake"><span class="hljs-comment"># ... in your test file</span>

<span class="hljs-comment"># ... previous not shown ...</span>

define_test(<span class="hljs-string">"can build assets"</span> <span class="hljs-string">"can_build_assets"</span>)
<span class="hljs-keyword">function</span>(can_build_assets)
    
    <span class="hljs-comment"># ... testing logic not shown ...</span>
    
    assert_truthy(assets_built <span class="hljs-keyword">MESSAGE</span> <span class="hljs-string">"Assets could bot be built..."</span>)
<span class="hljs-keyword">endfunction</span>()

define_test(<span class="hljs-string">"fails if assets not ready"</span> <span class="hljs-string">"fails_when_not_ready"</span> EXPECT_FAILURE)
<span class="hljs-keyword">function</span>(fails_when_not_ready)

    <span class="hljs-comment"># ... testing logic not shown ...</span>

    assert_truthy(<span class="hljs-keyword">false</span> <span class="hljs-keyword">MESSAGE</span> <span class="hljs-string">"Assets should not be built when not ready..."</span>)
<span class="hljs-keyword">endfunction</span>()

<span class="hljs-comment"># ... etc</span>
</code></pre>
<h3><a id="build-run" href="#build-run" class="Permalink" aria-hidden="true" title="Permalink">#</a>Build &amp; Run</h3>
<p>To run the tests, you must first build the project using CMake. After that, use
<a href="https://cmake.org/cmake/help/latest/manual/ctest.1.html#manual:ctest(1)" class="Link--external" rel="noopener noreferrer">CTests</a> to run the tests.</p>
<pre><code class="hljs bash">ctest --output-on-failure --parallel --<span class="hljs-built_in">test</span>-dir &lt;your-build-directory&gt;/tests
</code></pre>
<h2><a id="caveats" href="#caveats" class="Permalink" aria-hidden="true" title="Permalink">#</a>Caveats</h2>
<p>Due to the nature of how tests are <a href="https://cmake.org/cmake/help/latest/command/add_test.html#command:add_test" class="Link--external" rel="noopener noreferrer">defined (<em>via ctest</em>)</a>,
and how this “mini” testing framework has been designed, you might be required to rebuild your CMake, whenever changes
are made to the various “define” functions’ parameters. This can, for instance, be when you rename a test function.</p>
<p>Throughout the remain of this documentation, if a “define” function requires rebuilding before changes take effect,
then it will be highlighted via a warning, similar to the one shown below:</p>
<div class="Admonition Admonition--warning"><p class="Admonition__title">Rebuild Required</p><p>Changes to function <code>xyz</code> parameters requires you to rebuild your project, before the changes take effect.</p></div>
    </div>

        <nav>
        <ul class="Pager">
            <li class=Pager--prev><a href="../../../../current/modules/testing/index.html">Previous</a></li>            <li class=Pager--next><a href="../../../../current/modules/testing/cmake/test_suite.html">Next</a></li>        </ul>
    </nav>
    </article>

            </div>
        </div>
    </div>
</div>

    
    <!-- JS -->
            <script src="../../../../themes/rsp/js/main.mjs"></script>
    
        <script>
        
        window.searchLanguage = "";
        window.searchTranslation = {"Search_one_result":"1 result","Search_results":"!count results","Search_no_results":"Nothing found","Search_common_words_ignored":"Common words are largely ignored","Search_too_short":"Search too short","Search_one_character_or_more":"Should be one character or more","Search_should_be_x_or_more":"Should be !min characters or more","Link_previous":"Previous","Link_next":"Next"};
    </script>

    <!-- Search -->
    <script type="text/javascript" src="../../../../daux_libraries/search.min.js"></script>

    <script>
        window.search({'base_url': '../../../../'})
    </script>
</body>
</html>
